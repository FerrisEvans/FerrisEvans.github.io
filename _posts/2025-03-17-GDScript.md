---
title: "[Godot学习随笔03] GDScript"
date: 2025-03-17
categories: [Game Dev, Godot]
tags: [gdscript]
math: false
mermaid: false
render_with_liquid: false
---

## 0. GDScript 风格指南 

由于 GDScript 与 Python 十分相似，所以可以参考 [PEP08](https://peps.python.org/pep-0008/)。

如下是参考了本篇[指南](https://docs.godotengine.org/en/stable/tutorials/scripting/gdscript/gdscript_styleguide.html)的完整例子。
```GDScript
class_name StateMachine
extends Node
## Hierarchical State machine for the player.
##
## Initializes states and delegates engine callbacks ([method Node._physics_process],
## [method Node._unhandled_input]) to the state.

signal state_changed(previous, new)

@export var initial_state: Node
var is_active = true:
	set = set_is_active

@onready var _state = initial_state:
	set = set_state
@onready var _state_name = _state.name


func _init():
	add_to_group("state_machine")


func _enter_tree():
	print("this happens before the ready method!")


func _ready():
	state_changed.connect(_on_state_changed)
	_state.enter()


func _unhandled_input(event):
	_state.unhandled_input(event)


func _physics_process(delta):
	_state.physics_process(delta)


func transition_to(target_state_path, msg={}):
	if not has_node(target_state_path):
		return

	var target_state = get_node(target_state_path)
	assert(target_state.is_composite == false)

	_state.exit()
	self._state = target_state
	_state.enter(msg)
	Events.player_state_changed.emit(_state.name)


func set_is_active(value):
	is_active = value
	set_physics_process(value)
	set_process_unhandled_input(value)
	set_block_signals(not value)


func set_state(value):
	_state = value
	_state_name = _state.name


func _on_state_changed(previous, new):
	print("state changed")
	state_changed.emit()


class State:
	var foo = 0

	func _init():
		print("Hello!")
```

### 0.1 格式化

- 使用 LF 用作换行符
- 使用不带有字节顺序标记的 UTF-8 进行编码
- 使用 <kbd>Tab</kbd> 进行缩进而不是 <kbd>Space</kbd>。


### 命名约定

Node的命名使用PascalCase，单词之间没有空格，每个单词大写开头。

其他命名大部分使用蛇形命名法。所有内容都是小写，如果有空格则使用下划线。

## 1. Definition

### 1.1 Variables
You have all the basic datatypes(**int**, **float**, **bool**, **string**, **dicts**). No **Tuples** and **Lists** are replaced by **Arrays**.

```gdscript
# variables and constants
var current_speed = 200
const max_speed = 500
```

You can change the datatype dynamically or you can force one datatype for a variable.

```gdscript
var a_string: String = 'test'
var a_number: int = 123
var switch: bool = true
var some_numbers: Array[int] = [1, 2, 3, 4]
```

### 1.2 Functions

You create functions with `func`. You can specify datatypes for parameters and the return value.

```gdscript
func test_function(param_a: int, param_b: String) -> :
    return true
```

If you don't specify a return value, `void` is returned. Like in Python, indentations assign lines of code to a function.

> There are lots of inbuilt functions you will use, they all start with an `_`.
> 1. `_ready()` is run when a Node is added to the node tree.
> 2. `_process()` is run on every frame of the game.
     {: .prompt-tip }

### 1.3 Flow

You have `if` statements, `while` & `for` loops alongs with the comparison operators (also `continue` & `break`)

### 1.4 Classes

A script is always added to a Node, that Node is a class with default methods and attributes.

Adding a script to a Node2D creates an object with a position, rotation, scale etc.

You can use code to change these calues and also add new ones.

You can target other nodes in 2 ways:
1. `get_node("node path")`
2. `$node path`
